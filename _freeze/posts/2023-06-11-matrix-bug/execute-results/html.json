{
  "hash": "fedcf2aaab3f38e525046e58124178b8",
  "result": {
    "markdown": "---\ntitle: \"What's so special about `array`s?\"\n---\n\n\nI'm working on a new video about S3 objects in R and class inheritance / hierarchy. One of my favorite functions for exploring objecs and their structure is `unclass()`.\n\nThe documentation states  \n\n> `unclass` returns (a copy of) its argument with its class attribute removed. (It is not allowed for objects which cannot be copied, namely environments and external pointers.)\n\n::: {.aside}\nsee `?unclass` and review `Details`\n:::\n\nSo, `unclass()` _should_ remove the class of any and all objects. For the sake clarity of this post I'm going to make a helper function.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclass_unclass <- function(x) class(unclass(x))\n```\n:::\n\n\n\nThis works for `factor`s which are just integer vectors which have the attribute `levels`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclass_unclass(factor())\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"integer\"\n```\n:::\n:::\n\n\nand `data.frame`s are lists (also technically a vector just not atomic but instead recursive) with attributes `row.names`, and `names`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclass_unclass(data.frame())\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"list\"\n```\n:::\n:::\n\n\nBut when we get down to `matrix` another poser type (just like data.frame and factor pretending to be something they're not actually), we get something different. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nclass_unclass(matrix())\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"matrix\" \"array\" \n```\n:::\n:::\n\n\nWell, why the heck is that? What about it makes it so special? Let's explore this a bit more. \n\nThe two things that make a matrix are the classes `c(\"matrix\", \"array\")` and the `dim` attribute which specifies the dimensions. Matrixes are two dimensional arrays, by the way! \n\n\n::: {.cell}\n\n```{.r .cell-code}\nattributes(matrix())\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n$dim\n[1] 1 1\n```\n:::\n:::\n\n\nWhat is weird is that you can make a matrix just by adding the `dim` attribute to a vector.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm <- structure(integer(1), dim = c(1, 1))\nclass_unclass(m)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"matrix\" \"array\" \n```\n:::\n:::\n\n\nWe didn't even specify the class. Why does this happen?\n\nAnd when we remove the dim attribute....\n\n\n::: {.cell}\n\n```{.r .cell-code}\nattr(m, \"dim\") <- NULL\nclass_unclass(m)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"integer\"\n```\n:::\n:::\n\n\nwe get an integer vector. This differs from the behavior of other similar types. Recall that factors are `integer` vectors with an attribute of `levels` that is a character vector. \n\nSo let's try something here. Let's create a factor from scratch. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nstructure(integer(), levels = character(), class = \"factor\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nfactor()\nLevels: \n```\n:::\n:::\n\n\nNow, if the behavior is similar to `matrix` or `array` we would expect that by omitting the `class` attribute R should reconstruct it.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstructure(integer(), levels = character())\n```\n\n::: {.cell-output .cell-output-stdout}\n```\ninteger(0)\nattr(,\"levels\")\ncharacter(0)\n```\n:::\n:::\n\n\nNope! Would you look at that! \n\n[**@yjunechoe**](https://github.com/yjunechoe) pointed me to some excerpts from [Deep R Programming](https://deepr.gagolewski.com/), a book I wish I had read yesterday. It refers to these attributes as \"_special attributes_\". The author, [Marek Gagolewski](https://www.gagolewski.com/) (author of [`stringi`](https://stringi.gagolewski.com/), by the way), makes note of this special behavior of matrix but leaves it at that. \n\nTo me, this is a fundamental inconsistency in the language. Either all poser types (data.frame, matrix, factor, etc) should be automatically created if their special attributes are set on the appropriate type or not at all. What justification is there for _only_ `matrix` having a special behavior in `unclass()`? \n\nTo me, this warrants a bug report for `unclass()`. Based on the documentation, `unclass()` should _always_ remove the class attribute from an object but it fails to do so for `arrays` and `matrix`es. \n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}